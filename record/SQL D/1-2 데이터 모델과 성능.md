# 데이터 모델과 성능

## 목차
- [정규화(Normalization)](#Point-1-정규화)
- [정규화의 성능](#Point-2-정규화의-성능)
- [반정규화(e-Normalization)](#Point-3-반정규화)
- [분산 데이터베이스](#Point-4-분산-데이터베이스)

### POINT 1 정규화
1. 정규화(Normalization)
    - `데이터 일관성`, `최소한의 데이터 중복`, `최대한의 데이터 유연성`을 위한 방법으로서 데이터를 분해하는 과정이다.
    - 데이터 중복을 제거하고, 데이터 모델의 독립성을 확보하기 위한 방법이다.
    - 정규화를 수행하면 비즈니스에 변화가 발생하여도 데이터 모델의 변경을 최소화 할 수 있다.
    - 정규화는 제1차정규화부터 제5차정규화까지 있지만, 실질적으로 제3정규화까지만 수행한다.

    - **정규화 절차**

        | 정규화 절차 | 설명 |
        | --- | --- |
        | 제1정규화 | - 속성의 원자성을 확보한다. <br> - 기본키를 설정한다. |
        | 제2정규화 | 기본키가 2개 이상의 속성으로 이루어진 경우, 부분 함수 종속성을 제거(분해)한다. |
        | 제3정규화 | - 기본키를 제외한 컬럼 간에 종속성을 제거한다. <br> - 이행 함수 종속성을 제거한다. |
        | BCNF | 기본키를 제외하고 후보키가 있는 경우, 후보키가 기본키를 종속시키면 분해한다. |
        | 제4정규화 | 여러 칼럼들이 하나의 칼럼을 종속시키는 겨우 분해하여 다중 값 종속성을 제거한다. |
        | 제5정규화 | 조인에 의해서 종속성이 발생되는 경우 분해한다. |

2. 종속적 정규화(Functional Dependency)
    1. 제1정규화
        - 정규화는 함수적 종속성을 근거로 한다. 함수적 종속성이란 X->Y이면 Y는 X에 함수적으로 종속한다고 말한다.
        - 함수적 종속성은 X가 변화하면 Y도 변화하는지 확인한다. 예를 들어 회원ID가 변화하면 이름도 변경될 것이다. 이런 경우는 회원ID가 기본키가 되고, 회원ID가 이름을 함수적으로 종속한다고 한다.
        - 기본키를 잡는 것이 제1정규화이다.

    2. 제2정규화
        - 부분 함수 종속성이란, 기본키가 2개 이상의 칼럼으로 이루어진 경우에만 발생한다.
        - 기본키가 하나의 컬럼으로 이루어지면 제2정규화는 생략한다.
        - 기본키가 계좌번호, 회원ID이고 속성이 계좌명, 예수금, 이름, 관리점이 있는 테이블에서, 기본키인 회원ID가 변경되면 이름이 변경된다. 이러한 경우 회원ID가 이름을 함수적으로 종속하고 있고, 이를 `부분 함수 종속성`이라고 한다. 부분 함수 종속성이 발생하면 분해를 한다.
        - 따라서, 회원이라는 새로운 테이블이 도출되고 회원ID가 기본키가 된다.

    3. 제3정규화
        - 제3정규화는 이행 함수 종속성을 제거한다. 이행 함수 종속성이란, 기본키를 제외하고 칼럼간에 종속성이 발생하는 것이다.
        - 제3정규화는 제1정규화와 제2정규화를 수행한 다음에 해야 한다.
        - 기본키가 계좌번호, 회원ID이고 속성이 계좌명, 예수금, 관리점 코드, 관리점 테이블이 존재할 때, 관리점 속성이 관리점 코드에 종속되므로 이행 함수 종속성이라고 한다.
        - 따라서, 관리점 테이블이 도출되고, 관리점 코드가 기본키가 된다.

    4. BCNF(Boyce-Codd Normalization Form)
        - BCNF는 복수의 후보키가 있고, 후보키들이 복합 속성이어야 하며, 서로 중첩되어야 한다.
        - 기본키가 학번, 과목 번호이고 속성이 교수이 테이블이 있고, 학번과 과목 번호가 교수를 함수족으로 종속하고 있다.
        - 이떄 교수가 후보키이고 교수가 과목 번호를 함수적으로 종속하는 경우 분해가 일어난다.
        - 따라서 교수 테이블이 새롭게 만들어지고 기본키는 교수로 하고 칼럼은 과목 번호가 된다.
        - 이러한 작업을 BCNF라고 한다.

### POINT 2 정규화의 성능
1. 정규화의 문제점
    - 정규화는 테이블을 분해해서 데이터 중복을 제거하기 때문에 데이터 모델의 유연성을 높인다.
    - 정규화는 데이터 조회시에 조인을 유발하기 대문에 CPU와 메모리를 많이 사용한다.
    - 조인을 사용하다 보면, 중첩된 루프(Nested Loop)를 사용해야 하는 경우가 발생한다. 데이터양이 증가하면 비교해야 하는 건수도 증가하여 성능 문제가 있을 수 있다.
    - 결론적으로 조인이 부하를 유발하는 것은 분명하다,
    - 따라서, 이러한 문제를 해결하기 위해 `인덱스`와 `옵티마이저`를 사용하거나, 반겅규화를 하는 방법이 있다.
    - 성능 저하를 해결하기 위해 반정규화가 있고, 반정규화를 통해 하나의 테이블에 저장한다면 조인을 통한 성능 저하를 해결할 수 있다.

2. 정규화를 사용한 성능 튜닝
    - 정규화는 조인으로 인하여 성능이 저하되므로 반정규화로 해결한다.
    - 반정규화는 데이터를 중복하기 때문에 또 다른 문제점이 발생할 수 있다.
    - 예를 들어, 어떤 테이블에서 칼럼이 계속적으로 증가하면 조인이 최소화되기 때문에 조회를 빠르게 할 수 있다.
    - 하지만 너무 많은 칼럼이 추가되면 한 개의 행의 크기가 데이터베이스 관리 시스템의 입출력 단위인 블록 의 크기를 넘어서게 된다.
    - 그렇게 되면 한 개의 행을 읽기 위해서 여러 개의 블록을 읽어야 한다. 한 행을 읽기 위해서 여러 개의 블록을 읽게 되면 DISK IO가 증가하기 때문에 성능이 떨어지게 된다.
    - 반정규화는 이러한 문제점을 유발할 수가 있다.
    - 위와 같은 문제가 발생하면 테이블을 분해하는 방법밖에 없다. 따라서 정규화는 입출력 데이터의 양을 줄여서 성능을 향상시킬 수 있다.

### POINT 3 반정규화
1. 반정규화(De-Normalization)
    - 데이터베이스의 성능 향상을 위하여, 데이터 중복을 허용하고 조인을 줄이는 데이터베이스 성능 향상 방법이다.
    - 반정규화는 조회(SELECT) 속도를 향상하지만, 데이터 모델의 유연성은 낮아진다.

2. 반정규화를 수행하는 경우
    - 정규화에 충실하면 종속성, 활용성은 향상되지만 수행 속도가 느려지는 경우
    - 다량의 범위를 자주 처리해야 하는 경우
    - 특정 범위의 데이터만 자주 처리하는 경우
    - 요약/집계 정보가 자주 요구되는 경우
    - **반정규화 절차**

        | 반정규화 절차 | 설명 |
        | --- | --- |
        | 대사 조사 및 검토 | 데이터 처리 범위, 통계성 등을 확인해서 반정규화 대상을 조사한다. |
        | 다른 방법 검토 | - 반정규화를 수행하기 전에 다른 방법이 있는지 검토한다. <br> - 예를 들어 클러스터링, 뷰, 인덱스 튜닝, 응용 프로그램, 파티션 등을 검토한다. |
        | 반정규화 수행 | 테이블 속성, 관계 등을 반정규화 한다. |
    ```
    클러스터링(Clustering)
     - 클러스터링 인덱스라는 것은 인덱스 정보를 저장할 때 물리적으로 정렬해서 저장하는 방법이다.
     - 따라서 조회 시에 인접 블록을 연속적으로 읽기 때문에 성능이 향상된다.
    ```

3. 반정규화 기법
    1. 계산된 칼럼 추가
        - 배치 프로그램으로 총판매액,평균잔고, 계좌평가 등을 미리 계산하고, 그 결과를 특정 칼럼에 추가한다.

    2. 테이블 수직분할
        - 하나의 테이블을 두 개 이상의 테이블로 분할한다. 즉, 칼럼을 분할하여 새로운 테이블을 만드는 것이다.
    
    3. 테이블 수평분할
        - 하나의 테이블에 있는 값을 기준으로 테이블을 분할하는 방법이다.
    
    ```
    파티션(Partition) 기법
     - 데이터베이스에서 파티션을 사용해서 테이블을 분할할 수 있다. 파티션을 사용하면 논리적으로 하나의 테이블이지만 여러 개의 데이터 파일에 분산되어서 저장된다.
     - Range Partition : 데이터 값의 범위를 기준으로 파티션을 수행한다.
     - List Partition : 특정 값을 지정하여 파티션을 수행한다.
     - Hash Partition : 해시함수를 적용하여 파티션을 수행한다.
     - Composite Partition : 범위와 해시를 복합적으로 사용하여 파티션을 수행한다.
    ```

    ```
    파티션 테이블의 장점
     - 데이터 조회시에 액세스(Access) 범위가 줄어들기 떄문에 성능이 향상된다.
     - 데이터가 분할되어 있기 때문에 I/O 성능이 향상된다.
     - 각 파티션을 독립적으로 백업 및 복구가 가능한다.
     ```

4. 테이블 병합
    - 1:1 관계의 테이블을 하나의 테이블로 병합해서 성능을 향상시킨다.
    - 1대N 관계의 테이블을 병합하여 성능을 향상시킨다. 하지만 많은 양의 데이터 중복이 발생한다.
    - 슈퍼 타입과 서브 타입 관계가 발생하면 테이블을 통합하여 성능을 향상시킨다.
    ```
    Super type과 Sub type
     - 고객 엔터티는 개인고객과 법인고객으로 분류된다. 이떄 고객 엔터티는 슈퍼 타입이고 개인고객과 법인고객은 서브 타입이 된다.
     - 즉, 부모와 자식 간의 관게가 나타난다.
     - 슈퍼 타입과 서브 타입의 관계는 베타적 관계와 포괄적 관계가 있는데, 베타적 관계는 고객이 개인고객이거나 법인고객인 경우를 의미한다. 포괄적 관계는 고객이 개인고객일 수도 있고 법인 고객일 수도 있는 것이다.
     ```

### Point 4 분산 데이터베이스
1. 분산 데이터베이스
    - 데이터베이스 시스템 구축 시에 한 대의 물리적시스템에 DBMS을 설치하고 여러 명의 사용자가 DBMS에 접속하여 데이터베이스를 사용하는 구조를 `중앙 집중형 데이터베이스`라고 한다.
    - 물리적으로 떨어진 데이터베이스에 네트워크로 연결하여 단일 데이터베이스 이미지를 보여 주고 분산된 작업 처리를 수행하는 데이터베이스를 `분산 데이터베이스`라고 한다.
    - 분산 데이터베이스를 사용하는 고객은 시스템이 네트워크로 분산되어 있는지의 여부를 인식하지 못하면서, 자신만의 데이터베이스를 사용하는 것처럼 사용할 수 있다. 이처럼 데이터베이스는 투명성을 제공해야 한다.
    - 투명성은 분산 데이터베이스에서 중요한 요소이며 투명성의 종류에는 분할, 위치, 지역사상, 중복, 장애 및 병행 투명성이 있다.
    - **분산 데이터베이스의 투명성의 종류**

        | 투명성 | 설명 |
        | --- | --- |
        | 분할 투명성 | 고객은 하나의 논리적 릴레이션이 여러 단편으로 분할되어 각 단편의 사본이 여러 시스템에 저장되어 있음을 인식할 필요가 없다. |
        | 위치 투명성 | - 고객이 사용하려는 데이터의 저장 장소를 명시할 필요가 없다. <br> - 고객은 데이터가 어느 위치에 있덜도 동일한 명령을 사용하여 데이터에 접근할 수 있어야 한다. |
        | 지역 사상 투명성 | 지역 DBMS와 물리적 데이터베이스 사이의 사상이 보장됨에 따라 각 지역 시스템 이름과 무관한 이름이 사용 가능하다. |
        | 중복 투명성 | 데이터베이스 객체가 여러 시스템에 중복되어 존재함에도 고객과는 무관하게 데이터의 일관성이 유지된다. |
        | 장애 투명성 | 데이터베이스가 분산되어 있는 각 지역의 시스템이나 통신망에 이상이 발생해도, 데이터의 무결성은 보장된다. |
        | 병행 투명성 | 여러 고객의 응용 프로그램이 동시에 분산 데이터베이스에 대한 ㅡ랜잭션을 수행하는 경우에도 결과에 이상이 없다. |

2. 분산 데이터베이스 설계 방식
    - 분산 데이터베이스의 구축 방법에는 상향식 설계방식과 하향식 설계방식 2가지가 있다.
    - 상향식 설계방식 : 지역 스키마 작성 후 향후 전역 스키마를 작성하여 분산 데이터베이스를 구축한다.
    - 하향식 설계방식 : 전역 스키마 작성 후 해당 지역 사상 스키마를 작성하여 분산 데이터베이스를 구축한다.
    - 분산 데이터베이스를 하향식 접근 방식으로 구축한다는 것은 기업 전체의 전사 데이터 모델을 수렵하여 전역 스키마를 생성하고, 그 다음 각 지역별로 지역 스키마를 생성하여 분산 데이터베이스를 구축하는 것이다. 상향식 접근 방식은 지역별로 데이터베이스를 구축한 후에 전역 스키마로 통합하는 것이다.
    - 분산 데이터베이스를 구축하거나 운영할 떄 동일한 데이터베이스 관리 시스템으로 분산 데이터베이스를 구축하는 것은 크게 어렵지 않다. 하지만 기업에 여러 종류의 데이터베이스 관리시스템이 있으면 이기종 데이터베이스 관리 시스템으로 연동해야 한다. 이기종 데이터베이스 시스템으로 연동하기 위해서는 데이터베이스 미들웨어를 사용해야 한다.
    - **분산 데이터베이스 장점과 단점**

        | 장점 | 단점 |
        | --- | ---|
        | - 데이터베이스 신뢰성과 가용성이 높다. <br> - 분산 데이터베이스가 병렬 처리를 수행하기 때문에 빠른 응답이 가능한다. <br> - 분산 데이터베이스를 추가하여 시스템 용량 확장이 쉽다. | - 데이터베이스가 여러 네트워크를 통해 분리되어 있기 때문에 관리와 통제가 어렵다. <br> - 보안관리가 어렵다. <br> - 데이터 무결성 관리가어렵다. <br> - 데이터베이스 설계가 복잡하다. |